Using device: cuda
================================================================================
Using simple structural encoder (fallback, not GearNet)
Reason: TorchDrug GearNet hanging issue (see TORCHDRUG_ISSUE.md)
To switch back to GearNet: set use_simple_encoder=False after fixing TorchDrug
================================================================================
Created SimpleStructuralEncoder with hidden_dim=320
  Parameters: 318,720
Loaded and cached 191791 proteins.
Loaded and cached structural tokens for 191784 proteins.
Dataset split: 153432 training, 38359 validation samples.
Starting constrained training for 10 epochs...

--- Epoch 1/10 ---
Warning: idx 191789 out of range for structural_tokens (len=191784)
Warning: idx 191790 out of range for structural_tokens (len=191784)
Warning: idx 191784 out of range for structural_tokens (len=191784)
Warning: idx 191786 out of range for structural_tokens (len=191784)
Warning: idx 191788 out of range for structural_tokens (len=191784)
Warning: idx 191785 out of range for structural_tokens (len=191784)
Warning: idx 191787 out of range for structural_tokens (len=191784)
Epoch 1 Summary:
  Train | Lagrangian: 1.7668, MLM: 1.7668, Dihedral: 1.1650, GNN: 6.4735, Foldseek: 3.2211
  Val   | MLM: 1.6565, Dihedral: 5.8437, GNN: 6.5041, Foldseek: 3.2553
  Lambda distributions logged for epoch 1
  Checkpoint saved to outputs/checkpoint_epoch_1

--- Epoch 2/10 ---
Warning: idx 191788 out of range for structural_tokens (len=191784)
Warning: idx 191789 out of range for structural_tokens (len=191784)
Warning: idx 191784 out of range for structural_tokens (len=191784)
Warning: idx 191785 out of range for structural_tokens (len=191784)
Warning: idx 191786 out of range for structural_tokens (len=191784)
Warning: idx 191790 out of range for structural_tokens (len=191784)
Warning: idx 191787 out of range for structural_tokens (len=191784)
Epoch 2 Summary:
  Train | Lagrangian: 1.6556, MLM: 1.6320, Dihedral: 0.8848, GNN: 5.9403, Foldseek: 2.9271
  Val   | MLM: 1.6047, Dihedral: 4.1782, GNN: 5.8535, Foldseek: 2.8565
  Lambda distributions logged for epoch 2
  Checkpoint saved to outputs/checkpoint_epoch_2

--- Epoch 3/10 ---
Warning: idx 191790 out of range for structural_tokens (len=191784)
Warning: idx 191788 out of range for structural_tokens (len=191784)
Warning: idx 191789 out of range for structural_tokens (len=191784)
Warning: idx 191785 out of range for structural_tokens (len=191784)
Warning: idx 191784 out of range for structural_tokens (len=191784)
Warning: idx 191786 out of range for structural_tokens (len=191784)
Warning: idx 191787 out of range for structural_tokens (len=191784)
Epoch 3 Summary:
  Train | Lagrangian: 1.6388, MLM: 1.5997, Dihedral: 0.8223, GNN: 5.8367, Foldseek: 2.8435
  Val   | MLM: 1.5786, Dihedral: 4.0598, GNN: 5.8219, Foldseek: 2.8371
  Lambda distributions logged for epoch 3
  Checkpoint saved to outputs/checkpoint_epoch_3

--- Epoch 4/10 ---
Warning: idx 191786 out of range for structural_tokens (len=191784)
Warning: idx 191789 out of range for structural_tokens (len=191784)
Warning: idx 191790 out of range for structural_tokens (len=191784)
Warning: idx 191788 out of range for structural_tokens (len=191784)
Warning: idx 191784 out of range for structural_tokens (len=191784)
Warning: idx 191785 out of range for structural_tokens (len=191784)
Warning: idx 191787 out of range for structural_tokens (len=191784)
Epoch 4 Summary:
  Train | Lagrangian: 1.6349, MLM: 1.5803, Dihedral: 0.8129, GNN: 5.8197, Foldseek: 2.8323
  Val   | MLM: 1.5605, Dihedral: 4.0451, GNN: 5.8096, Foldseek: 2.8287
  Lambda distributions logged for epoch 4
  Checkpoint saved to outputs/checkpoint_epoch_4

--- Epoch 5/10 ---
Warning: idx 191784 out of range for structural_tokens (len=191784)
Warning: idx 191789 out of range for structural_tokens (len=191784)
Warning: idx 191788 out of range for structural_tokens (len=191784)
Warning: idx 191785 out of range for structural_tokens (len=191784)
Warning: idx 191790 out of range for structural_tokens (len=191784)
Warning: idx 191786 out of range for structural_tokens (len=191784)
Warning: idx 191787 out of range for structural_tokens (len=191784)
Epoch 5 Summary:
  Train | Lagrangian: 1.6355, MLM: 1.5655, Dihedral: 0.8095, GNN: 5.8113, Foldseek: 2.8258
  Val   | MLM: 1.5463, Dihedral: 4.0388, GNN: 5.8038, Foldseek: 2.8226
  Lambda distributions logged for epoch 5
  Checkpoint saved to outputs/checkpoint_epoch_5

--- Epoch 6/10 ---
Warning: idx 191786 out of range for structural_tokens (len=191784)
Warning: idx 191784 out of range for structural_tokens (len=191784)
Warning: idx 191785 out of range for structural_tokens (len=191784)
Warning: idx 191789 out of range for structural_tokens (len=191784)
Warning: idx 191790 out of range for structural_tokens (len=191784)
Warning: idx 191788 out of range for structural_tokens (len=191784)
Warning: idx 191787 out of range for structural_tokens (len=191784)
Epoch 6 Summary:
  Train | Lagrangian: 1.6394, MLM: 1.5541, Dihedral: 0.8052, GNN: 5.8056, Foldseek: 2.8211
  Val   | MLM: 1.5348, Dihedral: 4.0291, GNN: 5.7994, Foldseek: 2.8198
  Lambda distributions logged for epoch 6
  Checkpoint saved to outputs/checkpoint_epoch_6

--- Epoch 7/10 ---
Warning: idx 191788 out of range for structural_tokens (len=191784)
Warning: idx 191789 out of range for structural_tokens (len=191784)
Warning: idx 191786 out of range for structural_tokens (len=191784)
Warning: idx 191790 out of range for structural_tokens (len=191784)
Warning: idx 191785 out of range for structural_tokens (len=191784)
Warning: idx 191784 out of range for structural_tokens (len=191784)
Warning: idx 191787 out of range for structural_tokens (len=191784)
Epoch 7 Summary:
  Train | Lagrangian: 1.6464, MLM: 1.5458, Dihedral: 0.8032, GNN: 5.8012, Foldseek: 2.8178
  Val   | MLM: 1.5278, Dihedral: 3.9966, GNN: 5.7955, Foldseek: 2.8166
  Lambda distributions logged for epoch 7
  Checkpoint saved to outputs/checkpoint_epoch_7

--- Epoch 8/10 ---
Warning: idx 191785 out of range for structural_tokens (len=191784)
Warning: idx 191790 out of range for structural_tokens (len=191784)
Warning: idx 191789 out of range for structural_tokens (len=191784)
Warning: idx 191784 out of range for structural_tokens (len=191784)
Warning: idx 191786 out of range for structural_tokens (len=191784)
Warning: idx 191788 out of range for structural_tokens (len=191784)
Warning: idx 191787 out of range for structural_tokens (len=191784)
Epoch 8 Summary:
  Train | Lagrangian: 1.6546, MLM: 1.5388, Dihedral: 0.8002, GNN: 5.7982, Foldseek: 2.8158
  Val   | MLM: 1.5215, Dihedral: 3.9836, GNN: 5.7922, Foldseek: 2.8142
  Lambda distributions logged for epoch 8
  Checkpoint saved to outputs/checkpoint_epoch_8

--- Epoch 9/10 ---
Warning: idx 191789 out of range for structural_tokens (len=191784)
Warning: idx 191790 out of range for structural_tokens (len=191784)
Warning: idx 191786 out of range for structural_tokens (len=191784)
Warning: idx 191785 out of range for structural_tokens (len=191784)
Warning: idx 191784 out of range for structural_tokens (len=191784)
Warning: idx 191788 out of range for structural_tokens (len=191784)
Warning: idx 191787 out of range for structural_tokens (len=191784)
Epoch 9 Summary:
  Train | Lagrangian: 1.6631, MLM: 1.5321, Dihedral: 0.7977, GNN: 5.7958, Foldseek: 2.8142
  Val   | MLM: 1.5152, Dihedral: 3.9746, GNN: 5.7905, Foldseek: 2.8133
  Lambda distributions logged for epoch 9
  Checkpoint saved to outputs/checkpoint_epoch_9

--- Epoch 10/10 ---
Warning: idx 191784 out of range for structural_tokens (len=191784)
Warning: idx 191790 out of range for structural_tokens (len=191784)
Warning: idx 191788 out of range for structural_tokens (len=191784)
Warning: idx 191789 out of range for structural_tokens (len=191784)
Warning: idx 191786 out of range for structural_tokens (len=191784)
Warning: idx 191785 out of range for structural_tokens (len=191784)
Warning: idx 191787 out of range for structural_tokens (len=191784)
Epoch 10 Summary:
  Train | Lagrangian: 1.6754, MLM: 1.5292, Dihedral: 0.7966, GNN: 5.7946, Foldseek: 2.8135
  Val   | MLM: 1.5133, Dihedral: 3.9741, GNN: 5.7901, Foldseek: 2.8132
  Lambda distributions logged for epoch 10
  Checkpoint saved to outputs/checkpoint_epoch_10
Final LoRA adapters saved to outputs/final_model
Logged final lambda histograms to wandb.

Training completed!
