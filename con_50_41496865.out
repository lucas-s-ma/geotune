Using device: cuda
================================================================================
Using simple structural encoder (fallback, not GearNet)
Reason: TorchDrug GearNet hanging issue (see TORCHDRUG_ISSUE.md)
To switch back to GearNet: set use_simple_encoder=False after fixing TorchDrug
================================================================================
Created SimpleStructuralEncoder with hidden_dim=320
  Parameters: 318,720
Loaded and cached 191791 proteins.
Loaded and cached structural tokens for 191784 proteins.
Dataset split: 153432 training, 38359 validation samples.
Starting constrained training for 10 epochs...

--- Epoch 1/10 ---
Warning: idx 191790 out of range for structural_tokens (len=191784)
Warning: idx 191784 out of range for structural_tokens (len=191784)
Warning: idx 191786 out of range for structural_tokens (len=191784)
Warning: idx 191788 out of range for structural_tokens (len=191784)
Warning: idx 191785 out of range for structural_tokens (len=191784)
Warning: idx 191789 out of range for structural_tokens (len=191784)
Warning: idx 191787 out of range for structural_tokens (len=191784)
Epoch 1 Summary:
  Train | Lagrangian: 1.7668, MLM: 1.7668, Dihedral: 1.1654, GNN: 6.4733, Foldseek: 3.2211
  Val   | MLM: 1.6561, Dihedral: 5.8608, GNN: 6.5076, Foldseek: 3.2522
  Lambda distributions logged for epoch 1
  Checkpoint saved to outputs/checkpoint_epoch_1

--- Epoch 2/10 ---
Warning: idx 191785 out of range for structural_tokens (len=191784)
Warning: idx 191786 out of range for structural_tokens (len=191784)
Warning: idx 191784 out of range for structural_tokens (len=191784)
Warning: idx 191790 out of range for structural_tokens (len=191784)
Warning: idx 191788 out of range for structural_tokens (len=191784)
Warning: idx 191789 out of range for structural_tokens (len=191784)
Warning: idx 191787 out of range for structural_tokens (len=191784)
Epoch 2 Summary:
  Train | Lagrangian: 1.6939, MLM: 1.6325, Dihedral: 0.8545, GNN: 5.9018, Foldseek: 2.8946
  Val   | MLM: 1.6063, Dihedral: 4.0599, GNN: 5.8323, Foldseek: 2.8423
  Lambda distributions logged for epoch 2
  Checkpoint saved to outputs/checkpoint_epoch_2

--- Epoch 3/10 ---
Warning: idx 191790 out of range for structural_tokens (len=191784)
Warning: idx 191788 out of range for structural_tokens (len=191784)
Warning: idx 191789 out of range for structural_tokens (len=191784)
Warning: idx 191785 out of range for structural_tokens (len=191784)
Warning: idx 191784 out of range for structural_tokens (len=191784)
Warning: idx 191786 out of range for structural_tokens (len=191784)
Warning: idx 191787 out of range for structural_tokens (len=191784)
Epoch 3 Summary:
  Train | Lagrangian: 1.7101, MLM: 1.6006, Dihedral: 0.7971, GNN: 5.8207, Foldseek: 2.8313
  Val   | MLM: 1.5790, Dihedral: 3.9366, GNN: 5.8089, Foldseek: 2.8262
  Lambda distributions logged for epoch 3
  Checkpoint saved to outputs/checkpoint_epoch_3

--- Epoch 4/10 ---
Warning: idx 191786 out of range for structural_tokens (len=191784)
Warning: idx 191789 out of range for structural_tokens (len=191784)
Warning: idx 191790 out of range for structural_tokens (len=191784)
Warning: idx 191788 out of range for structural_tokens (len=191784)
Warning: idx 191784 out of range for structural_tokens (len=191784)
Warning: idx 191785 out of range for structural_tokens (len=191784)
Warning: idx 191787 out of range for structural_tokens (len=191784)
Epoch 4 Summary:
  Train | Lagrangian: 1.7382, MLM: 1.5810, Dihedral: 0.7831, GNN: 5.8069, Foldseek: 2.8209
  Val   | MLM: 1.5609, Dihedral: 3.8847, GNN: 5.7983, Foldseek: 2.8178
  Lambda distributions logged for epoch 4
  Checkpoint saved to outputs/checkpoint_epoch_4

--- Epoch 5/10 ---
Warning: idx 191786 out of range for structural_tokens (len=191784)
Warning: idx 191784 out of range for structural_tokens (len=191784)
Warning: idx 191789 out of range for structural_tokens (len=191784)
Warning: idx 191788 out of range for structural_tokens (len=191784)
Warning: idx 191785 out of range for structural_tokens (len=191784)
Warning: idx 191790 out of range for structural_tokens (len=191784)
Warning: idx 191787 out of range for structural_tokens (len=191784)
Epoch 5 Summary:
  Train | Lagrangian: 1.7711, MLM: 1.5662, Dihedral: 0.7736, GNN: 5.7995, Foldseek: 2.8153
  Val   | MLM: 1.5487, Dihedral: 3.8508, GNN: 5.7923, Foldseek: 2.8129
  Lambda distributions logged for epoch 5
  Checkpoint saved to outputs/checkpoint_epoch_5

--- Epoch 6/10 ---
Warning: idx 191790 out of range for structural_tokens (len=191784)
Warning: idx 191788 out of range for structural_tokens (len=191784)
Warning: idx 191786 out of range for structural_tokens (len=191784)
Warning: idx 191789 out of range for structural_tokens (len=191784)
Warning: idx 191784 out of range for structural_tokens (len=191784)
Warning: idx 191785 out of range for structural_tokens (len=191784)
Warning: idx 191787 out of range for structural_tokens (len=191784)
Epoch 6 Summary:
  Train | Lagrangian: 1.8072, MLM: 1.5549, Dihedral: 0.7655, GNN: 5.7942, Foldseek: 2.8118
  Val   | MLM: 1.5355, Dihedral: 3.8067, GNN: 5.7884, Foldseek: 2.8112
  Lambda distributions logged for epoch 6
  Checkpoint saved to outputs/checkpoint_epoch_6

--- Epoch 7/10 ---
Warning: idx 191788 out of range for structural_tokens (len=191784)
Warning: idx 191789 out of range for structural_tokens (len=191784)
Warning: idx 191786 out of range for structural_tokens (len=191784)
Warning: idx 191790 out of range for structural_tokens (len=191784)
Warning: idx 191784 out of range for structural_tokens (len=191784)
Warning: idx 191785 out of range for structural_tokens (len=191784)
Warning: idx 191787 out of range for structural_tokens (len=191784)
Epoch 7 Summary:
  Train | Lagrangian: 1.8461, MLM: 1.5466, Dihedral: 0.7568, GNN: 5.7896, Foldseek: 2.8094
  Val   | MLM: 1.5297, Dihedral: 3.7503, GNN: 5.7836, Foldseek: 2.8081
  Lambda distributions logged for epoch 7
  Checkpoint saved to outputs/checkpoint_epoch_7

--- Epoch 8/10 ---
Warning: idx 191784 out of range for structural_tokens (len=191784)
Warning: idx 191786 out of range for structural_tokens (len=191784)
Warning: idx 191788 out of range for structural_tokens (len=191784)
Warning: idx 191785 out of range for structural_tokens (len=191784)
Warning: idx 191789 out of range for structural_tokens (len=191784)
Warning: idx 191790 out of range for structural_tokens (len=191784)
Warning: idx 191787 out of range for structural_tokens (len=191784)
Epoch 8 Summary:
  Train | Lagrangian: 1.8862, MLM: 1.5397, Dihedral: 0.7480, GNN: 5.7861, Foldseek: 2.8078
  Val   | MLM: 1.5228, Dihedral: 3.7065, GNN: 5.7803, Foldseek: 2.8069
  Lambda distributions logged for epoch 8
  Checkpoint saved to outputs/checkpoint_epoch_8

--- Epoch 9/10 ---
Warning: idx 191789 out of range for structural_tokens (len=191784)
Warning: idx 191790 out of range for structural_tokens (len=191784)
Warning: idx 191786 out of range for structural_tokens (len=191784)
Warning: idx 191785 out of range for structural_tokens (len=191784)
Warning: idx 191784 out of range for structural_tokens (len=191784)
Warning: idx 191788 out of range for structural_tokens (len=191784)
Warning: idx 191787 out of range for structural_tokens (len=191784)
Epoch 9 Summary:
  Train | Lagrangian: 1.9266, MLM: 1.5330, Dihedral: 0.7395, GNN: 5.7830, Foldseek: 2.8066
  Val   | MLM: 1.5159, Dihedral: 3.6698, GNN: 5.7775, Foldseek: 2.8059
  Lambda distributions logged for epoch 9
  Checkpoint saved to outputs/checkpoint_epoch_9

--- Epoch 10/10 ---
Warning: idx 191788 out of range for structural_tokens (len=191784)
Warning: idx 191789 out of range for structural_tokens (len=191784)
Warning: idx 191786 out of range for structural_tokens (len=191784)
Warning: idx 191785 out of range for structural_tokens (len=191784)
Warning: idx 191784 out of range for structural_tokens (len=191784)
Warning: idx 191790 out of range for structural_tokens (len=191784)
Warning: idx 191787 out of range for structural_tokens (len=191784)
Epoch 10 Summary:
  Train | Lagrangian: 1.9710, MLM: 1.5304, Dihedral: 0.7345, GNN: 5.7811, Foldseek: 2.8061
  Val   | MLM: 1.5141, Dihedral: 3.6576, GNN: 5.7764, Foldseek: 2.8058
  Lambda distributions logged for epoch 10
  Checkpoint saved to outputs/checkpoint_epoch_10
Final LoRA adapters saved to outputs/final_model
Logged final lambda histograms to wandb.

Training completed!
