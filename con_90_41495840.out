Using device: cuda
================================================================================
Using simple structural encoder (fallback, not GearNet)
Reason: TorchDrug GearNet hanging issue (see TORCHDRUG_ISSUE.md)
To switch back to GearNet: set use_simple_encoder=False after fixing TorchDrug
================================================================================
Created SimpleStructuralEncoder with hidden_dim=320
  Parameters: 318,720
Loaded and cached 191791 proteins.
Loaded and cached structural tokens for 191784 proteins.
Dataset split: 153432 training, 38359 validation samples.
Starting constrained training for 10 epochs...

--- Epoch 1/10 ---
Warning: idx 191790 out of range for structural_tokens (len=191784)
Warning: idx 191784 out of range for structural_tokens (len=191784)
Warning: idx 191786 out of range for structural_tokens (len=191784)
Warning: idx 191788 out of range for structural_tokens (len=191784)
Warning: idx 191785 out of range for structural_tokens (len=191784)
Warning: idx 191789 out of range for structural_tokens (len=191784)
Warning: idx 191787 out of range for structural_tokens (len=191784)
Epoch 1 Summary:
  Train | Lagrangian: 1.7666, MLM: 1.7666, Dihedral: 1.1658, GNN: 6.4729, Foldseek: 3.2211
  Val   | MLM: 1.6553, Dihedral: 5.8563, GNN: 6.5017, Foldseek: 3.2536
  Lambda distributions logged for epoch 1
  Checkpoint saved to outputs/checkpoint_epoch_1

--- Epoch 2/10 ---
Warning: idx 191788 out of range for structural_tokens (len=191784)
Warning: idx 191789 out of range for structural_tokens (len=191784)
Warning: idx 191785 out of range for structural_tokens (len=191784)
Warning: idx 191786 out of range for structural_tokens (len=191784)
Warning: idx 191784 out of range for structural_tokens (len=191784)
Warning: idx 191790 out of range for structural_tokens (len=191784)
Warning: idx 191787 out of range for structural_tokens (len=191784)
Epoch 2 Summary:
  Train | Lagrangian: 1.6419, MLM: 1.6320, Dihedral: 0.9131, GNN: 5.9810, Foldseek: 2.9645
  Val   | MLM: 1.6063, Dihedral: 4.2573, GNN: 5.8737, Foldseek: 2.8727
  Lambda distributions logged for epoch 2
  Checkpoint saved to outputs/checkpoint_epoch_2

--- Epoch 3/10 ---
Warning: idx 191790 out of range for structural_tokens (len=191784)
Warning: idx 191788 out of range for structural_tokens (len=191784)
Warning: idx 191789 out of range for structural_tokens (len=191784)
Warning: idx 191785 out of range for structural_tokens (len=191784)
Warning: idx 191786 out of range for structural_tokens (len=191784)
Warning: idx 191784 out of range for structural_tokens (len=191784)
Warning: idx 191787 out of range for structural_tokens (len=191784)
Epoch 3 Summary:
  Train | Lagrangian: 1.6147, MLM: 1.6001, Dihedral: 0.8387, GNN: 5.8547, Foldseek: 2.8577
  Val   | MLM: 1.5793, Dihedral: 4.1421, GNN: 5.8382, Foldseek: 2.8507
  Lambda distributions logged for epoch 3
  Checkpoint saved to outputs/checkpoint_epoch_3

--- Epoch 4/10 ---
Warning: idx 191788 out of range for structural_tokens (len=191784)
Warning: idx 191784 out of range for structural_tokens (len=191784)
Warning: idx 191785 out of range for structural_tokens (len=191784)
Warning: idx 191790 out of range for structural_tokens (len=191784)
Warning: idx 191786 out of range for structural_tokens (len=191784)
Warning: idx 191789 out of range for structural_tokens (len=191784)
Warning: idx 191787 out of range for structural_tokens (len=191784)
Epoch 4 Summary:
  Train | Lagrangian: 1.6002, MLM: 1.5805, Dihedral: 0.8328, GNN: 5.8346, Foldseek: 2.8463
  Val   | MLM: 1.5605, Dihedral: 4.1587, GNN: 5.8235, Foldseek: 2.8424
  Lambda distributions logged for epoch 4
  Checkpoint saved to outputs/checkpoint_epoch_4

--- Epoch 5/10 ---
Warning: idx 191784 out of range for structural_tokens (len=191784)
Warning: idx 191788 out of range for structural_tokens (len=191784)
Warning: idx 191785 out of range for structural_tokens (len=191784)
Warning: idx 191790 out of range for structural_tokens (len=191784)
Warning: idx 191789 out of range for structural_tokens (len=191784)
Warning: idx 191786 out of range for structural_tokens (len=191784)
Warning: idx 191787 out of range for structural_tokens (len=191784)
Epoch 5 Summary:
  Train | Lagrangian: 1.5903, MLM: 1.5655, Dihedral: 0.8322, GNN: 5.8244, Foldseek: 2.8403
  Val   | MLM: 1.5494, Dihedral: 4.1586, GNN: 5.8158, Foldseek: 2.8369
  Lambda distributions logged for epoch 5
  Checkpoint saved to outputs/checkpoint_epoch_5

--- Epoch 6/10 ---
Warning: idx 191786 out of range for structural_tokens (len=191784)
Warning: idx 191790 out of range for structural_tokens (len=191784)
Warning: idx 191788 out of range for structural_tokens (len=191784)
Warning: idx 191789 out of range for structural_tokens (len=191784)
Warning: idx 191784 out of range for structural_tokens (len=191784)
Warning: idx 191785 out of range for structural_tokens (len=191784)
Warning: idx 191787 out of range for structural_tokens (len=191784)
Epoch 6 Summary:
  Train | Lagrangian: 1.5840, MLM: 1.5544, Dihedral: 0.8322, GNN: 5.8182, Foldseek: 2.8358
  Val   | MLM: 1.5353, Dihedral: 4.1733, GNN: 5.8115, Foldseek: 2.8342
  Lambda distributions logged for epoch 6
  Checkpoint saved to outputs/checkpoint_epoch_6

--- Epoch 7/10 ---
Warning: idx 191785 out of range for structural_tokens (len=191784)
Warning: idx 191788 out of range for structural_tokens (len=191784)
Warning: idx 191789 out of range for structural_tokens (len=191784)
Warning: idx 191786 out of range for structural_tokens (len=191784)
Warning: idx 191790 out of range for structural_tokens (len=191784)
Warning: idx 191784 out of range for structural_tokens (len=191784)
Warning: idx 191787 out of range for structural_tokens (len=191784)
Epoch 7 Summary:
  Train | Lagrangian: 1.5807, MLM: 1.5461, Dihedral: 0.8332, GNN: 5.8134, Foldseek: 2.8322
  Val   | MLM: 1.5286, Dihedral: 4.1516, GNN: 5.8069, Foldseek: 2.8304
  Lambda distributions logged for epoch 7
  Checkpoint saved to outputs/checkpoint_epoch_7

--- Epoch 8/10 ---
Warning: idx 191784 out of range for structural_tokens (len=191784)
Warning: idx 191786 out of range for structural_tokens (len=191784)
Warning: idx 191788 out of range for structural_tokens (len=191784)
Warning: idx 191790 out of range for structural_tokens (len=191784)
Warning: idx 191785 out of range for structural_tokens (len=191784)
Warning: idx 191789 out of range for structural_tokens (len=191784)
Warning: idx 191787 out of range for structural_tokens (len=191784)
Epoch 8 Summary:
  Train | Lagrangian: 1.5783, MLM: 1.5389, Dihedral: 0.8328, GNN: 5.8104, Foldseek: 2.8298
  Val   | MLM: 1.5221, Dihedral: 4.1589, GNN: 5.8044, Foldseek: 2.8280
  Lambda distributions logged for epoch 8
  Checkpoint saved to outputs/checkpoint_epoch_8

--- Epoch 9/10 ---
Warning: idx 191786 out of range for structural_tokens (len=191784)
Warning: idx 191785 out of range for structural_tokens (len=191784)
Warning: idx 191784 out of range for structural_tokens (len=191784)
Warning: idx 191788 out of range for structural_tokens (len=191784)
Warning: idx 191789 out of range for structural_tokens (len=191784)
Warning: idx 191790 out of range for structural_tokens (len=191784)
Warning: idx 191787 out of range for structural_tokens (len=191784)
Epoch 9 Summary:
  Train | Lagrangian: 1.5765, MLM: 1.5321, Dihedral: 0.8328, GNN: 5.8077, Foldseek: 2.8278
  Val   | MLM: 1.5162, Dihedral: 4.1474, GNN: 5.8017, Foldseek: 2.8264
  Lambda distributions logged for epoch 9
  Checkpoint saved to outputs/checkpoint_epoch_9

--- Epoch 10/10 ---
Warning: idx 191786 out of range for structural_tokens (len=191784)
Warning: idx 191788 out of range for structural_tokens (len=191784)
Warning: idx 191789 out of range for structural_tokens (len=191784)
Warning: idx 191784 out of range for structural_tokens (len=191784)
Warning: idx 191790 out of range for structural_tokens (len=191784)
Warning: idx 191785 out of range for structural_tokens (len=191784)
Warning: idx 191787 out of range for structural_tokens (len=191784)
Epoch 10 Summary:
  Train | Lagrangian: 1.5786, MLM: 1.5293, Dihedral: 0.8324, GNN: 5.8064, Foldseek: 2.8267
  Val   | MLM: 1.5138, Dihedral: 4.1546, GNN: 5.8015, Foldseek: 2.8262
  Lambda distributions logged for epoch 10
  Checkpoint saved to outputs/checkpoint_epoch_10
Final LoRA adapters saved to outputs/final_model
Logged final lambda histograms to wandb.

Training completed!
